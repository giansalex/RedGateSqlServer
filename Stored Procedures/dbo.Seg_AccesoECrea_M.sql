SET QUOTED_IDENTIFIER OFF
GO
SET ANSI_NULLS ON
GO
CREATE procedure [dbo].[Seg_AccesoECrea_M] -- Procedimiento Masivo
@PrfPri nvarchar(3),
@PrfSec nvarchar(3),
@Cadena nvarchar(4000),
@msj varchar(100) output
as

Declare @RucE nvarchar(11)
Declare @Cd_GA int
Set @RucE = ''
Set @Cd_GA = 0;

while(len(@Cadena) >= 1)
begin
	Set @RucE = left(@Cadena,11)
	Set @Cadena = right(@Cadena,len(@Cadena)-11)
	Set @Cd_GA = (select Cd_GA from AccesoE where Cd_Prf=@PrfPri and RucE=@RucE )

	Print @RucE
	Print @Cadena
	Print @Cd_GA

	insert into AccesoE(Cd_Prf,RucE,Cd_GA)
	values(@PrfSec,@RucE,@Cd_GA)


	if @@rowcount <= 0
	begin
		Set @msj = 'Empresa no pudo ser asignada'
		return
	end
end


--PRUEBAS
/*
declare @rucs varchar(4000)
set @rucs ='1007263695910078687202100917748661009178778010093971073100975187131010245897010402018289104242524711042479481910436735788104525698751111111111120100023203201001340212010040965920100977037201060766352011011730320110143215201106895282011094465020124578923201256282912013416117620186137273202136588252025146239020264081484202661943242029523215420299858635203016951452033063423620339146528203395712292037902845520380151414203871350742038871099420389723836204288752822045257452820458136654204641923532046864956120477951849204779925292047809258120478093471204791000562048067077020491936291204919569932049199210820492004988204920262812049209568120492317251204923948322049240554120492699781204928085812049296550320492966062204929668102049298625020493003446204930896512050175332820501980812205019961402050203654920502527526205026532382050306062120504069541205041093572050499685020506202800205071656222050720748120507377999205083205832050884082020509196762205092429772050944506120509777579205101862152051069358320511052735205111412402051163907820511973059205121674122051224477820512635025205131785822051327284820513302852205133422182051378342720513842377205138668022051403606420514120367205141860312051450655920514563358205146501612051469763020515034065205150434802051512421820515293249205152935912051532449720515689070205160373782051613767420516243601205164458162051655311220516822202205168328522051691563420516980452205170628562051706358520517309096205175446812051793102120517986438205181097082051817079220518693540205188238512051890639020519031451205190803122051908325720519252890205193727982051942566220520572300205206600042052072689720520727192205207282452052077630420520790714205208206482052085721520520883721205210982532052140200920521620090205217130042052174457120522060578205220770392052208661520522266273205222762362052227780120522384802205224454452052262763220522855694205230025802052303168722222222222'

exec dbo.Seg_AccesoECrea_M '001','052',@rucs,null
*/
--
GO
