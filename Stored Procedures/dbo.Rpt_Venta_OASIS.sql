SET QUOTED_IDENTIFIER ON
GO
SET ANSI_NULLS ON
GO
CREATE PROCEDURE [dbo].[Rpt_Venta_OASIS] @RucE nvarchar(11), @Eje nvarchar(4), @Cd_Vta nvarchar(10), @msj varchar(100) output AS SELECT v.RucE,v.Cd_Vta, v.NroDoc, v.Cd_Sr, s.NroSerie,v.FecMov,v.Cd_Cte,CASE(isnull(len(a.RSocial),0)) WHEN 0 THEN a.ApPat+' '+a.ApMat+' '+a.Nom ELSE a.RSocial END AS NomComCte, v.Total, v.Obs FROM Venta v, Serie s, Auxiliar a WHERE v.RucE=@RucE AND v.Cd_Vta=@Cd_VTa AND v.RucE=s.RucE AND v.Cd_Sr=s.Cd_Sr AND v.RucE=a.RucE AND v.Cd_Cte=a.Cd_Aux DECLARE @M1 decimal(13,2), @M2 decimal(13,2), @M3 decimal(13,2), @M4 decimal(13,2), @M5 decimal(13,2) SET @M1 = 0 SET @M2 = 0 SET @M3 = 0 SET @M4 = 0 SET @M5 = 0 IF EXISTS (SELECT * FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='11') SET @M1 = (SELECT Total FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='11') IF EXISTS (SELECT * FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='12') SET @M2 = (SELECT Total FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='12') IF EXISTS (SELECT * FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='13') SET @M3 = (SELECT Total FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='13') IF EXISTS (SELECT * FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='14') SET @M4 = (SELECT Total FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='14') IF EXISTS (SELECT * FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='15') SET @M5 = (SELECT Total FROM VentaDet WHERE RucE=@RucE AND Cd_Vta=@Cd_VTa AND Cd_Pro='15') SELECT @RucE AS RucE , @Cd_Vta AS Cd_Vta, '11' AS 'COD.CUO.MANTE.', @M1 AS 'M1', '12' AS 'COD.ENE.ELECT.', @M2 AS 'M2', '13' AS 'COD.CRIA.CABA.', @M3 AS 'M3', '14' AS 'COD.TRAB.ESPE.', @M4 AS 'M4', '15' AS 'COD.OTROS', @M5 AS 'M5' DECLARE @CA1 nvarchar(100), @CA2 nvarchar(100), @CA3 nvarchar(100) SET @CA1 = '' SET @CA2 = '' SET @CA3 = '' IF EXISTS (SELECT * FROM CampoV WHERE RucE=@RucE AND Cd_Vta=@Cd_Vta AND Cd_Cp='01') SET @CA1 = (SELECT Valor FROM CampoV WHERE RucE=@RucE AND Cd_Vta=@Cd_Vta AND Cd_Cp='01') IF EXISTS (SELECT * FROM CampoV WHERE RucE=@RucE AND Cd_Vta=@Cd_Vta AND Cd_Cp='02') SET @CA2 = (SELECT Valor FROM CampoV WHERE RucE=@RucE AND Cd_Vta=@Cd_Vta AND Cd_Cp='02') IF EXISTS (SELECT * FROM CampoV WHERE RucE=@RucE AND Cd_Vta=@Cd_Vta AND Cd_Cp='03') SET @CA3 = (SELECT Valor FROM CampoV WHERE RucE=@RucE AND Cd_Vta=@Cd_Vta AND Cd_Cp='03') SELECT @RucE AS RucE, @Cd_Vta AS Cd_Vta, @CA1 AS 'PROPIETARIO',@CA2 AS 'LOTE',@CA3 AS 'OTROS' PRINT @msj
GO
